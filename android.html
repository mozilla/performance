<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Android Metrics</title>

<link href="https://fonts.googleapis.com/css2?family=Zilla+Slab:wght@400;700&display=swap" rel="stylesheet">
<link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.1/css/all.min.css" rel="stylesheet">
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<link rel="stylesheet" href="assets/main-ui-style.css">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.2.1"></script>
<script src="https://cdn.jsdelivr.net/npm/moment/min/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-moment"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.0.4/pako.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/js-untar@2.0.0/build/dist/untar.js"></script>

<link rel="stylesheet" href="assets/android-style.css">

<script src="assets/android-metrics.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", async () => {
      // Check URL parameters for timeline
      const urlParams = new URLSearchParams(window.location.search);
      const timeline = urlParams.get('timeline') || '90';

      // Always use mozilla-central for data
      window.selectedRepository = 'mozilla-central';
      window.selectedTimeline = parseInt(timeline);

      // Load data from Treeherder API
      await loadDataFromTreeherder();
  });
</script>

</head>
<body>
<div class="top">
  <a href="javascript:history.back()" class="btn back-btn" title="Go Back">
    <i class="fa-solid fa-arrow-left"></i>
  </a>
  <div class="top-title-container">
    <div class="top-title">
      <b>moz://a</b> performance portal
    </div>
  </div>
  <a href="https://firefox-source-docs.mozilla.org/performance/reporting_a_performance_problem.html" class="btn" title="Report a Performance Bug">
    <i class="fa-solid fa-bug"></i> Report Performance Issue
  </a>
</div>

<div class="main-content">
  <aside class="main-sidebar" id="main-sidebar">
  </aside>

  <div class="content android-content">
    <div class="device-selector">
      <button id="a55-button" class="device-button active" onclick="selectDevice('a55')">A55</button>
      <button id="p6-button" class="device-button" onclick="selectDevice('p6')">P6</button>
      <button id="s24-button" class="device-button" onclick="selectDevice('s24')">S24</button>
    </div>


    <div id="video-container" class="video-container-top" style="display: none;">
      <div class="video-header">
        <div style="display: flex; flex-direction: column; gap: 8px; flex: 1;">
          <div style="display: flex; gap: 20px; align-items: center;">
            <div>
              <label for="replicate-select" style="font-weight: bold; margin-right: 10px; font-size: 14px;">Replicate:</label>
              <select id="replicate-select" onchange="selectReplicate(this.value)" style="padding: 6px 10px; border-radius: 5px; border: 1px solid #ccc; font-size: 13px;">
              </select>
            </div>
            <div id="data-point-info" style="font-size: 13px; color: #444;">
            </div>
          </div>
          <div style="font-size: 12px;">
            <a id="job-link" href="#" target="_blank" style="color: #667eea; text-decoration: none;">View Job in Treeherder</a>
          </div>
        </div>
        <button onclick="closeVideo()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #666; padding: 0; line-height: 1;">&times;</button>
      </div>
      <div id="video-loading" style="display: none; text-align: center; padding: 40px; background: #f0f0f0; border-radius: 8px;">
        <div style="display: inline-block; width: 50px; height: 50px; border: 5px solid #ddd; border-top-color: #667eea; border-radius: 50%; animation: spin 1s linear infinite;"></div>
        <div style="margin-top: 15px; font-size: 14px; color: #666;">Loading video...</div>
      </div>
      <video id="perf-video" controls style="width: 100%; height: 350px; border-radius: 8px; background: #000;">
        Your browser does not support the video tag.
      </video>
      <div style="margin-top: 8px; font-size: 13px; color: #666; text-align: center;">
        <span id="video-info"></span>
      </div>
    </div>

    <style>
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      .main-chart-container a:hover {
        background-color: lightgray;
      }
    </style>

    <div class="row-title" id="main-chart-section">
      <a id="main-chart-title" href="#" target="_blank">newssite-applink-startup (A55)</a>
    </div>

    <div style="width: 100%; max-width: 900px; margin: 0 auto; display: flex; justify-content: flex-end; margin-bottom: 5px;">
      <div id="hide-alerts-container-android" style="display: block; background: #f0f0f0; padding: 8px 12px; border-radius: 4px; border: 1px solid #ccc;">
        <label style="font-size: 13px; cursor: pointer; display: flex; align-items: center; gap: 6px; margin: 0;">
          <input type="checkbox" id="hide-alerts-android" onchange="toggleHideAlertsAndroid(this.checked)" style="cursor: pointer;">
          <span>Hide alerts</span>
        </label>
      </div>
    </div>

    <div class="main-chart-container" style="margin: 0 auto;">
      <canvas id="main-chart"></canvas>
      <div style="text-align: center; margin-top: 10px;">
        <a onclick="changeTimelineAndroid(365)" style="padding: 10px 30px; margin: 0 5px; cursor: pointer; text-decoration: none; color: black; border-radius: 5px; display: inline-block;">1 year</a>
        <a onclick="changeTimelineAndroid(90)" style="padding: 10px 30px; margin: 0 5px; cursor: pointer; text-decoration: none; color: black; border-radius: 5px; display: inline-block;">3 months</a>
        <a onclick="changeTimelineAndroid(30)" style="padding: 10px 30px; margin: 0 5px; cursor: pointer; text-decoration: none; color: black; border-radius: 5px; display: inline-block;">1 month</a>
      </div>
    </div>

    <div class="row-title" id="summary-section">Test Results</div>

    <div class="table-container">
      <table class="styled-table" id="summary-table">
        <thead>
          <tr>
            <th colspan="4" scope="colgroup">Latest (7 day avg)</th>
          </tr>
          <tr>
            <th onclick="sortTable('name')" class="testName">Test Name</th>
            <th onclick="sortTable('firefoxAvg')">Firefox</th>
            <th onclick="sortTable('chromeAvg')">Chrome</th>
            <th onclick="sortTable('difference')">Difference (%)</th>
          </tr>
        </thead>
        <tbody id="tableBody">
        </tbody>
      </table>
    </div>
  </div>

  <script>
      window.tests = [
        {
          name: "newssite-applink-startup (A55)",
          metric: ["newssite-applink-startup-a55"],
          unit: "ms"
        },
        {
          name: "newssite-applink-startup (P6)",
          metric: ["newssite-applink-startup-p6"],
          unit: "ms"
        },
        {
          name: "newssite-applink-startup (S24)",
          metric: ["newssite-applink-startup-s24"],
          unit: "ms"
        },
        {
          name: "shopify-applink-startup (A55)",
          metric: ["shopify-applink-startup-a55"],
          unit: "ms"
        },
        {
          name: "shopify-applink-startup (P6)",
          metric: ["shopify-applink-startup-p6"],
          unit: "ms"
        },
        {
          name: "shopify-applink-startup (S24)",
          metric: ["shopify-applink-startup-s24"],
          unit: "ms"
        },
        {
          name: "homeview-startup (A55)",
          metric: ["homeview-startup-a55"],
          unit: "ms"
        },
        {
          name: "homeview-startup (P6)",
          metric: ["homeview-startup-p6"],
          unit: "ms"
        },
        {
          name: "homeview-startup (S24)",
          metric: ["homeview-startup-s24"],
          unit: "ms"
        },
        {
          name: "restore-startup (A55)",
          metric: ["restore-startup-a55"],
          unit: "ms"
        },
        {
          name: "restore-startup (P6)",
          metric: ["restore-startup-p6"],
          unit: "ms"
        },
        {
          name: "restore-startup (S24)",
          metric: ["restore-startup-s24"],
          unit: "ms"
        },
        {
          name: "cold_view_nav_start.mean",
          metric: ["cold_view_nav_start.mean"],
          unit: "ms"
        },
        {
          name: "cold_main_first_frame.mean",
          metric: ["cold_main_first_frame.mean"],
          unit: "ms"
        },
        {
          name: "sp3",
          metric: ["score"],
          unit: "score"
        },
        {
          name: "sp3-cpuTime",
          metric: ["cpuTime"],
          unit: "ms"
        },
        {
          name: "sp3-powerUsage",
          metric: ["powerUsage"],
          unit: "mWh"
        },
        //{
        //  name: "background-main-cpuTime",
        //  metric: ["cpuTime-main-geomean"],
        //  unit: "ms"
        //},
        //{
        //  name: "background-gpu-cpuTime",
        //  metric: ["cpuTime-gpu-geomean"],
        //  unit: "ms"
        //},
        //{
        //  name: "background-tab-cpuTime",
        //  metric: ["cpuTime-tab-geomean"],
        //  unit: "ms"
        //},
        //{
        //  name: "background-main-rss",
        //  metric: ["rss-main-geomean"],
        //  unit: "kB"
        //},
        //{
        //  name: "background-gpu-rss",
        //  metric: ["rss-gpu-geomean"],
        //  unit: "kB"
        //},
        //{
        //  name: "background-tab-rss",
        //  metric: ["rss-tab-geomean"],
        //  unit: "kB"
        //},
        //{
        //  name: "background-main-pss",
        //  metric: ["pss-main-geomean"],
        //  unit: "kB"
        //},
        //{
        //  name: "background-gpu-pss",
        //  metric: ["pss-gpu-geomean"],
        //  unit: "kB"
        //},
        //{
        //  name: "background-tab-pss",
        //  metric: ["pss-tab-geomean"],
        //  unit: "kB"
        //},
        //{
        //  name: "allrecipes",
        //  metric: ["allrecipes-ContentfulSpeedIndex"],
        //  unit: "CSI"
        //},
        //{
        //  name: "amazon-search",
        //  metric: ["amazon-search-ContentfulSpeedIndex"],
        //  unit: "CSI"
        //},
        //{
        //  name: "espn",
        //  metric: ["espn-ContentfulSpeedIndex"],
        //  unit: "CSI"
        //},
        //{
        //  name: "google",
        //  metric: ["google-ContentfulSpeedIndex"],
        //  unit: "CSI"
        //},
        //{
        //  name: "microsoft-support",
        //  metric: ["microsoft-support-ContentfulSpeedIndex"],
        //  unit: "CSI"
        //},
        //{
        //  name: "amazon",
        //  metric: ["amazon-ContentfulSpeedIndex"],
        //  unit: "CSI"
        //},
        //{
        //  name: "bing",
        //  metric: ["bing-ContentfulSpeedIndex"],
        //  unit: "CSI"
        //},
        //{
        //  name: "bing-search-restaurants",
        //  metric: ["bing-search-restaurants-ContentfulSpeedIndex"],
        //  unit: "CSI"
        //},
        //{
        //  name: "booking",
        //  metric: ["booking-ContentfulSpeedIndex"],
        //  unit: "CSI"
        //},
        //{
        //  name: "cnn",
        //  metric: ["cnn-ContentfulSpeedIndex"],
        //  unit: "CSI"
        //},
        //{
        //  name: "cnn-ampstories",
        //  metric: ["cnn-ampstories-ContentfulSpeedIndex"],
        //  unit: "CSI"
        //},
        //{
        //  name: "dailymail",
        //  metric: ["dailymail-ContentfulSpeedIndex"],
        //  unit: "CSI"
        //},
        //{
        //  name: "ebay-kleinanzeigen",
        //  metric: ["ebay-kleinanzeigen-ContentfulSpeedIndex"],
        //  unit: "CSI"
        //},
        //{
        //  name: "ebay-kleinanzeigen-search",
        //  metric: ["ebay-kleinanzeigen-search-ContentfulSpeedIndex"],
        //  unit: "CSI"
        //},
        //{
        //  name: "facebook-cristiano",
        //  metric: ["facebook-cristiano-ContentfulSpeedIndex"],
        //  unit: "CSI"
        //},
        //{
        //  name: "google-maps",
        //  metric: ["google-maps-ContentfulSpeedIndex"],
        //  unit: "CSI"
        //},
        //{
        //  name: "google-search-restaurants",
        //  metric: ["google-search-restaurants-ContentfulSpeedIndex"],
        //  unit: "CSI"
        //},
        //{
        //  name: "imdb",
        //  metric: ["imdb-ContentfulSpeedIndex"],
        //  unit: "CSI"
        //},
        //{
        //  name: "instagram",
        //  metric: ["instagram-ContentfulSpeedIndex"],
        //  unit: "CSI"
        //},
        //{
        //  name: "reddit",
        //  metric: ["reddit-ContentfulSpeedIndex"],
        //  unit: "CSI"
        //},
        //{
        //  name: "sina",
        //  metric: ["sina-ContentfulSpeedIndex"],
        //  unit: "CSI"
        //},
        //{
        //  name: "stackoverflow",
        //  metric: ["stackoverflow-ContentfulSpeedIndex"],
        //  unit: "CSI"
        //},
        //{
        //  name: "wikipedia",
        //  metric: ["wikipedia-ContentfulSpeedIndex"],
        //  unit: "CSI"
        //},
        //{
        //  name: "youtube",
        //  metric: ["youtube-ContentfulSpeedIndex"],
        //  unit: "CSI"
        //}
      ];
  </script>
  </div>
</div>
<script src="assets/main-ui.js"></script>
</body>
</html>
